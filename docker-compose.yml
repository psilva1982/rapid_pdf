version: '3.8'

services:
  rapid-pdf:
    build:
      context: .
      dockerfile: Dockerfile
    image: severos/rapid-pdf:latest
    container_name: rapid-pdf
    ports:
      - "${PORT:-8080}:8080"
    environment:
      # Application configuration
      - PORT=${PORT:-8080}
      - MAX_URLS=${MAX_URLS:-10}
      - TIMEOUT_SECONDS=${TIMEOUT_SECONDS:-60}
      
      # AWS S3 configuration (optional)
      - AWS_S3_BUCKET=${AWS_S3_BUCKET:-}
      - AWS_S3_REGION=${AWS_S3_REGION:-}
      - AWS_S3_ACCESS_KEY=${AWS_S3_ACCESS_KEY:-}
      - AWS_S3_SECRET_KEY=${AWS_S3_SECRET_KEY:-}
    volumes:
      # Mount local media directory for PDF storage
      - ./media:/app/media
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/swagger/index.html"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    networks:
      - rapid-pdf-network

networks:
  rapid-pdf-network:
    driver: bridge
